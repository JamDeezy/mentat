#!/usr/bin/env node
var debug = require('debug');
var fsmonitor = require('fsmonitor');
var child_process = require('child_process');

var make = function() {
  var target = process.argv[2];
  var make;
  if (target) {
    make = child_process.spawn('make', [target], { stdio: 'inherit' })
  } else {
    make = child_process.spawn('make', ['default'], { stdio: 'inherit' })
  }
  make.on('exit', doneFn);
}

var running = true;
var doneFn = function() {
  console.timeEnd('make DONE');
  running = false;
}
make();
console.time('make DONE');

var changeFn = function(change) {
  if (running)
    return;

  running = true;
  make();
  console.time('make DONE');
};

fsmonitor.watch('./src', null, changeFn);
fsmonitor.watch('./tests', null, changeFn);

module.exports = fsmonitor;

